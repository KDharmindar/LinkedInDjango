 {% extends 'v2/app/base.html' %} {% load static %} {% block title %}Account{% endblock %}
{% block content %}
<div class="row mb-5 justify-content-center">
	<div class="col-md-7">
		<div class="card">
			<div class="card-header">
				<h2>
					<i class="batch-icon batch-icon-user-alt-3 batch-icon-xl"></i>
					Linkedin Accounts
				</h2>

                <a href="#" class="btn btn-primary waves-effect waves-light pull-right" data-izimodal-open="#add_linkedin_accout_modal" data-izimodal-zindex="20000" data-izimodal-preventclose="">
                    <i class="batch-icon batch-icon-user-alt-add">
                    </i>
                </a>
			</div>
			<div class="card-table table-responsive">
				<table class="table table-hover align-middle">
					<tbody>
						{% for item in object_list %}
						<td>
							{% if item.login_status %}
							<a href="{% url 'account-detail' pk=item.id %}">{{ item.email }}</a>
							{% else %}
							<a href="#" id="inactive_account_click" data-email="{{ item.email }}" data-pass="{{ item.password }}">{{ item.email }}</a>
							{% endif %}
						</td>
						<td>

						</td>
						<td class="text-center">
							<span class="float-right badge badge-{% if item.status %}success{% else %}warning{% endif %}">{% if item.status %} Active{% else %}Inactive{% endif %}</span>
						</td>
						<td class="text-right">
							{% if item.login_status %}

							<a class="btn bg-primary btn-sm btn-gradient" href="{% url 'account-settings' pk=item.id %}" data-toggle="tooltip" data-original-title=""
							    title="">
								<i class="batch-icon-settings batch-icon"></i>
							</a>
							{% endif %}
							<a class="btn bg-danger btn-sm btn-gradient" onclick="return deleteAccount({{item.id}})">
								<span class="batch-icon batch-icon-bin-alt-2"></span>
							</a>
						</td>
						</tr>
						{% endfor %}
					</tbody>
				</table>
			</div>		
		</div>
	</div>
</div>

<div id="add_linkedin_accout_modal" aria-hidden="true" aria-labelledby="modal-default" role="dialog" class="iziModal"  data-iziModal-title="Add Linkedin Account" data-iziModal-icon="batch-icon batch-icon-home">
	<div class="iziModal-progressbar">
		<div style="background-color: white; width: 0%;"></div>
	</div>
    {% include 'account/accounts/add_account_from.html' %}
</div>

<div id="remove_account" tabindex="-1" data-iziModal-title="Delete Account" data-iziModal-icon="batch-icon batch-icon-user-alt-remove-2">
	<div class="card">
        <div class="card-body">
            <div class="row">
                <div class="col-md-12">
                    <p>Are you sure you want to delete this account ?</p>
                    <p style="color:red">
                        All of your account data will be permanently deleted from B2B Prospects's servers and can't be restored.
                        <br>
                        <br> You can only use one LinkedIn account during the 7-day free trial. If you delete this LinkedIn account, your free
                        trial will end immediately. The next time you add this or any other LinkedIn account, you will have to pay for it
                        first.
                    </p>
                </div>
            </div>
        </div>
        <div class="card-footer">
            <button data-izimodal-close="" data-izimodal-transitionout="bounceOutDown" class="pull-left btn btn-success btn-gradient">Cancel</button>
            <a id="account_delete_confirm" href="#" class="btn btn-primary btn-gradient pull-right">Delete</a>
        </div>
    </div>
</div>

{% endblock content %}
{% block script %}
<script>
    $(function(){
        $('#add_linkedin_accout_modal').iziModal({
            theme: 'material',
            closeButton: true,
			width: 700,
            overlayClose:false		
        });

		$("#wizard-stage-1").validate({
			errorElement: "span",
			errorClass: "help-block help-block-error",
			focusInvalid: !1,
			ignore: "",
			rules: {
				email: {
					required: true,
					email: true
				},
				password: {
					required: true,
					minlength: 6
				}			
			},		
			errorPlacement: function (error, element) {
				var placement = $(element).data('error');
				if (placement) {
					$(placement).append(error)
				} else {
					error.insertAfter(element);
				}
			},
			highlight: function (e) {
				$(e).closest(".form-group").addClass("has-error")
			},
			unhighlight: function (e) {
				$(e).closest(".form-group").removeClass("has-error")
			},
			success: function (e) {
				e.closest(".form-group").removeClass("has-error")
			},
			submitHandler: function (e) {
				AjaxAddLinkedAccount();
			}
		});

        $('#remove_account').iziModal({
            theme: 'material',
            closeButton: true,
			width: 400,
            overlayClose:false
        });

    });
	function deleteAccount(linkedin_id) {
		$('#account_delete_confirm')[0].href = '/accounts/remove/' + linkedin_id;
		$('#remove_account').iziModal('open');
	}
		
	
	function AjaxAddLinkedAccount() {
		data = new Object()
		data.email = $('#email')[0].value;
		data.password = $('#password')[0].value;
		$("#div_add_email").hide();
		$(".progress-total").show();
		var counter = 0;

        $.ajax({
			url: '{% url 'add-account' %}',
			type: "post",
			data: data,
			success: function (response) {
			    counter++;
				load(data)				
				var interval = setInterval(function () {
					load(data)
                    if (counter >= 100){
					    clearInterval(interval);
                    }
				}, 10000);
			},
			error: function (jqXHR, textStatus, errorThrown) {
				$('#progress_result').show();
				if (jqXHR.responseText == '400')
					$('#progress_result').html(
						'<p class="text-danger"> Account with this email is already exists </p>')
				else
					$('#progress_result').html(
						'<p class="text-danger"> An error occur during add this acount. please reloade this page and try again </p>')
			}
		});
	}

	function addLinkedInAccount() {
		$("#wizard-stage-1").submit();
	}
	function load(data) {
		$.ajax({
			url: '{% url 'account-info' %}',
			type: "post",
			data: data,
			success: function (response) {
				console.log(response);
				$('#modal-form').hide();
				$('#add_connect_button').hide();
				$('#step_result_form').html(response)
			},
			error: function (jqXHR, textStatus, errorThrown) {
				console.log(textStatus, errorThrown);
			}
		});
	}

</script>
{% endblock script %}